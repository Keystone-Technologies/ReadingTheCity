<!DOCTYPE html>
<html>
    <head>
        <title>Reading the City</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="css/normalize.css" type="text/css" media="screen"/>
        <link rel="stylesheet" href="css/style.css" type="text/css" media="screen"/>
        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
        <script src="http://code.jquery.com/jquery-1.10.1.js"></script>
        <script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
        <style>
             div#NotificationBar { display:none; }
             .hide { color:gray }
        </style>
        <script>
            $(function(){
                function notify (json) {
                  if ( json == null ) {
                    $('div#NotificationBar').hide();
                  } else {
                    if ( json.thumbnail ) {
                      $('div#NotificationBar img#thumbnail').attr("src", json.thumbnail);
                      $('div#NotificationBar img#thumbnail').show();
                    } else {
                      $('div#NotificationBar img#thumbnail').hide();
                    }
                    $('div#NotificationBar span#id').html(json.major + ',' + json.minor);
                    $('div#NotificationBar a#url').attr("href", json.url).html(json.name);
                    $('div#NotificationBar span#description').html(json.description);
                    if ( json.child == null )
                      $('div#NotificationBar div#show').hide();
                    else
                      $('div#NotificationBar div#show').show();
                    $('div#NotificationBar').show();
                  }
                }
                var uuid;
                var ws = new WebSocket('<%= url_for('notification')->to_abs %>');
                ws.onmessage = function (event) {
                  notify(JSON.parse(event.data));
                };
                ws.onopen = function (event) {
                  ws.send(1);
                };
                $('div#NotificationBar div#show > div#yes').click(function(){
                  if ( uuid )
                    $.post("/response/"+uuid+"/1");
                });
                $('div#NotificationBar div#show > div#no').click(function(){
                  if ( uuid )
                    $.post("/response/"+uuid+"/0");
                });
                $(".Beacon > .FloatLeft > span.slider").each(function(){
                    var beacon = $(this).parent().parent();
                    var beaconuuid = $(beacon).attr('id');
                    var slider = $(this).empty().slider({
                        value: 0,
                        range: "min",
                        animate: true,
                        orientation: "vertical",
                        stop: function (e, ui) {
                          $.post("/rssi/"+beaconuuid+"/"+(ui.value*-1), function(data){
                            $(beacon).find("span.rssi").html(data.rssi);
                          });
                        }
                    });
                    $.post("/rssi/"+beaconuuid, function(data){
                      $(beacon).find("span.major").html(data.major);
                      $(beacon).find("span.minor").html(data.minor);
                      $(beacon).find("span.rssi").html(data.rssi);
                      $(slider).slider("value", -1*data.rssi);
                    });
                });
            });
        </script>
    </head>
    <body>

        <div id="Wrapper">

            <div id="NotificationBar">
              <div id="image">
                <img id="thumbnail" />
              </div>
              <div id="details">
                <span id="id"></span>: <a id="url" href="#"></a>
                <span id="description"></span>
              </div>
              <div id="show">
                <div id="yes">Yes</div><div id="no">No</div>
              </div>
            </div>

            <div id="Input">
                <div class="Beacon" id="b9407f30-f5f8-466e-aff9-25556b57fe6d-19665-6283">
                     <div class="FloatLeft"><span class="slider"></span></div>
                     <div class="FloatRight">
                         <p><span class="name">Michaelangelo's Sistine Chapel</span></p>
                         <p>Major ID: <span class="major"></span><br/>Minor ID: <span class="minor"></span></p>
                         <p>Signal Strength: <span class="rssi"></span> db</p>
                     </div>
                </div>
                <div class="Beacon" id="b9407f30-f5f8-466e-aff9-25556b57fe6d-6033-57725">
                     <div class="FloatLeft"><span class="slider"></span></div>
                     <div class="FloatRight">
                         <p><span class="name">Michaelangelo's David</span></p>
                         <p>Major ID: <span class="major"></span><br/>Minor ID: <span class="minor"></span></p>
                         <p>Signal Strength: <span class="rssi"></span> db</p>
                     </div>
                </div>
                <div class="Beacon" id="b9407f30-f5f8-466e-aff9-25556b57fe6d-14365-33884">
                     <div class="FloatLeft"><span class="slider"></span></div>
                     <div class="FloatRight">
                         <p><span class="name">Leonardo da Vinci's Mona Lisa</span></p>
                         <p>Major ID: <span class="major"></span><br/>Minor ID: <span class="minor"></span></p>
                         <p>Signal Strength: <span class="rssi"></span> db</p>
                     </div>
                </div>
                <div class="Beacon" id="b9407f30-f5f8-466e-aff9-25556b57fe6d-43891-24830">
                     <div class="FloatLeft"><span class="slider"></span></div>
                     <div class="FloatRight">
                         <p><span class="name">Leonardo da Vinci's Last Supper</span></p>
                         <p>Major ID: <span class="major"></span><br/>Minor ID: <span class="minor"></span></p>
                         <p>Signal Strength: <span class="rssi"></span> db</p>
                     </div>
                </div>
            </div>

        </div>

    </body>
</html>
